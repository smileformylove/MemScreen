#!/usr/bin/env python3
"""
MemScreen 记忆系统测试指南

显示测试步骤和验证方法
"""

print("""
╔══════════════════════════════════════════════════════════════════╗
║          MemScreen 记忆系统 - 快速测试指南                      ║
║                                                                    ║
║  版本: v0.4.0                                                    ║
║  日期: 2026-01-30                                               ║
╚══════════════════════════════════════════════════════════════════╝

📋 测试步骤
═══════════════════════════════════════════════════════════════

1️⃣  启动应用
   ┌──────────────────────────────────────────────────────────┐
   │ $ python3 start.py                                        │
   └──────────────────────────────────────────────────────────┘

2️⃣  录制屏幕内容
   ┌──────────────────────────────────────────────────────────┐
   │ a) 点击 "Recording" 标签                                   │
   │ b) 点击 "Start Recording" 按钮                            │
   │ c) 在屏幕上操作：                                         │
   │    - 打开代码编辑器                                        │
   │    - 或打开浏览器                                         │
   │    - 或编辑文档                                           │
   │ d) 录制 10-20 秒                                         │
   │ e) 点击 "Stop Recording"                                 │
   └──────────────────────────────────────────────────────────┘

   ✅ 成功标志: 控制台显示
      "[RecordingPresenter] ✅ Successfully added to memory"

3️⃣  测试记忆功能
   ┌──────────────────────────────────────────────────────────┐
   │ a) 点击 "AI Chat" 标签                                     │
   │ b) 输入: "我刚才在做什么？"                               │
   │ c) 点击 "Send" 按钮                                      │
   │ d) 等待 AI 回复                                           │
   └──────────────────────────────────────────────────────────┘

   ✅ 成功标志:
      - AI 能回答你刚才录制的内容
      - 控制台显示: "[Chat] Found X relevant memories"
      - 控制台显示: "[Chat] Saved conversation to memory"

4️⃣  测试连续对话
   ┌──────────────────────────────────────────────────────────┐
   │ 输入以下问题测试：                                         │
   │                                                           │
   │  • "我在写什么代码？"                                    │
   │  • "用的是哪个工具？"                                    │
   │  • "今天做了什么？"                                       │
   └──────────────────────────────────────────────────────────┘

   ✅ 成功标志: AI 能记住之前的对话和上下文


🔍 验证记忆是否正常
═══════════════════════════════════════════════════════════════

检查记忆系统中的所有内容：
  $ python3 -c "
  import sys
  sys.path.insert(0, '.')
  from memscreen import Memory
  from memscreen.memory.models import MemoryConfig

  config = MemoryConfig()
  memory = Memory(config=config)

  result = memory.search(query='任何', user_id='default_user', limit=10, threshold=0.0)

  if result and 'results' in result:
      print(f'找到 {len(result[\"results\"])} 条记忆：')
      for i, mem in enumerate(result['results'][:5], 1):
          content = mem.get('memory', mem.get('content', ''))[:80]
          metadata = mem.get('metadata', {})
          mem_type = metadata.get('type', metadata.get('source', 'unknown'))
          print(f'{i}. [{mem_type}] {content}...')
  "


✅ 成功标准
═══════════════════════════════════════════════════════════════

□ 录制后能保存到记忆系统
□ 对话后能自动保存
□ AI 能检索到相关记忆
□ AI 使用友好的中文回复
□ 回复简洁直接（1-2句话）
□ 能记住之前的对话内容


🐛 常见问题
═══════════════════════════════════════════════════════════════

Q: AI 说"没有找到相关记录"
A: 确保已经完成了屏幕录制，并等待几秒让录制保存完成

Q: 控制台显示 "Found 0 relevant memories"
A: 使用更通用的关键词，如"屏幕"、"代码"、"录制"等

Q: AI 不记得之前的对话
A: 检查控制台是否有 "Saved conversation to memory" 消息

Q: AI 回复太慢
A: 这是正常的，首次加载模型需要时间。后续会更快。


📊 优化效果
═══════════════════════════════════════════════════════════════

速度优化:
  • 响应时间: 2-3x 更快
  • Token 使用: 减少 60-70%
  • 搜索精度: 更高

语气改进:
  • 简洁直接: 1-2句话说明重点
  • 友好自然: 中文口语化表达
  • 准确真实: 只基于记忆回答


📝 测试示例对话
═══════════════════════════════════════════════════════════════

用户: 我刚才在做什么？
AI:   我看到你刚才在编辑 Python 代码，在处理图像识别功能。

用户: 我在写什么代码？
AI:  你在写使用 OpenCV 进行图像处理的代码。

用户: 用的是哪个编辑器？
AI:  从录制来看，你在使用 VSCode 编辑器。


💡 提示
═══════════════════════════════════════════════════════════════

• 录制时尽量有明确的操作（编辑代码、浏览网页等）
• 录制时间不要太短（建议 10-20 秒）
• 等待录制完全保存后再进行对话
• 使用具体的问题而不是模糊的问题

═══════════════════════════════════════════════════════════════
                        🎉 祝测试顺利！
═══════════════════════════════════════════════════════════════
""")
